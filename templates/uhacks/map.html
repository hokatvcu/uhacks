{% extends "base.html" %}
{% load static %}

{% block title%} MAP {% endblock title %}
{% block jstop %} 
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA7TO_foWjd8-G9now8GNGdFifAvAKixvc"></script>

<script>
  var myCenter = new google.maps.LatLng(39.8282,-98.5795);

  // TESTING
  var activeInfoWindow;  

  {% for hackathon in hackathons %}
      var {{hackathon}} = new google.maps.LatLng({{hackathon.lat}},{{hackathon.lon}});
      var {{hackathon}}Content = "{{ hackathon }}" + " " + "{{hackathon.city}}" + ", " + "{{ hackathon.state }}" + "-" + "{{hackathon.date|date:"d-m-Y"}}";

  {% endfor %}

// ************** INITIALIZE *******
  function initialize(){
    var mapProp = {
      center:myCenter,
      zoom:4,
      mapTypeId:google.maps.MapTypeId.ROADMAP
    };

  var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

  {% for hackathon in hackathons %}
      var {{hackathon}}Marker=new google.maps.Marker({ position:{{hackathon}},});
      {{hackathon}}Marker.setMap(map);

      var {{hackathon}}infowindow = new google.maps.InfoWindow({
  content:"{{ hackathon }}"});

  //     google.maps.event.addListener({{hackathon}}Marker, 'click', function() {
  // {{hackathon}}infowindow.open(map,{{hackathon}}Marker);
  // });

      google.maps.event.addListener({{hackathon}}Marker, 'mouseover', function() {
        
        // Close active window if exists - [one might expect this to be default behaviour no?]        
        if(activeInfoWindow != null) activeInfoWindow.close();

        // Close info Window on mouseclick if already opened
        
      
        // Open new InfoWindow for mouseover event
        {{hackathon}}infowindow.open(map, {{hackathon}}Marker);
        
        // Store new open InfoWindow in global variable
        activeInfoWindow = {{hackathon}}infowindow;       
      });               
      
      // on mouseout (moved mouse off marker) make infoWindow disappear
      google.maps.event.addListener({{hackathon}}Marker, 'mouseout', function() {
        {{hackathon}}infowindow.close();  
      });
  {% endfor %}
}

  google.maps.event.addDomListener(window, 'load', initialize);
</script>
    {% endblock jstop %}
    


{% block style %}{% endblock style %}


{% block body %}WTF<div id="googleMap" style="width:800px;height:450px;"></div>{% endblock body %}

{% block js %}{% endblock js %}